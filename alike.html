<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Alike ‚Äì Find out what you have in common</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #F5F0E8;
    --card: #FFFDF8;
    --ink: #1A1410;
    --muted: #8A8076;
    --match: #2ECC7A;
    --nomatch: #E84040;
    --skip: #B0A89C;
    --accent: #FF6B35;
    --accent2: #FFD166;
    --left-glow: rgba(255,107,53,0.15);
    --right-glow: rgba(46,204,122,0.15);
    --radius: 24px;
  }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow: hidden;
    position: relative;
  }

  /* Decorative blobs */
  body::before {
    content: '';
    position: fixed;
    top: -120px; right: -80px;
    width: 380px; height: 380px;
    background: radial-gradient(circle, rgba(255,209,102,0.35) 0%, transparent 70%);
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
  }
  body::after {
    content: '';
    position: fixed;
    bottom: -100px; left: -60px;
    width: 300px; height: 300px;
    background: radial-gradient(circle, rgba(255,107,53,0.2) 0%, transparent 70%);
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
  }

  /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
  .screen {
    position: fixed; inset: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 24px;
    z-index: 1;
    transition: opacity 0.4s, transform 0.4s;
  }
  .screen.hidden {
    opacity: 0; pointer-events: none; transform: scale(0.97);
  }

  /* ‚îÄ‚îÄ WELCOME ‚îÄ‚îÄ */
  #screen-welcome { gap: 0; }

  .logo-mark {
    width: 72px; height: 72px;
    background: var(--ink);
    border-radius: 20px;
    display: flex; align-items: center; justify-content: center;
    margin-bottom: 28px;
    position: relative;
    box-shadow: none;
  }
  .logo-mark svg { width: 40px; height: 40px; }

  h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(42px, 10vw, 64px);
    font-weight: 800;
    color: var(--ink);
    letter-spacing: -2px;
    line-height: 1;
    margin-bottom: 12px;
  }
  .tagline {
    font-size: 15px;
    color: var(--muted);
    letter-spacing: 0.5px;
    margin-bottom: 48px;
    max-width: 260px;
    text-align: center;
    line-height: 1.6;
  }

  /* Category chips */
  .categories {
    display: flex; flex-wrap: wrap; gap: 8px;
    justify-content: center;
    max-width: 340px;
    margin-bottom: 40px;
  }
  .cat-chip {
    padding: 10px 18px;
    border-radius: 100px;
    border: 1.5px solid var(--ink);
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    background: var(--card);
    color: var(--ink);
    transition: all 0.18s;
    user-select: none;
  }
  .cat-chip:hover, .cat-chip.active {
    background: var(--ink);
    color: var(--bg);
    transform: translateY(-2px);
  }
  .cat-chip.active {
  }

  .btn-primary {
    padding: 16px 40px;
    background: var(--ink);
    color: var(--bg);
    border: none;
    border-radius: 100px;
    font-family: 'Syne', sans-serif;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: all 0.18s;
  }
  .btn-primary:hover { transform: translate(-1px,-1px); }
  .btn-primary:active { transform: translate(1px,1px); }

  /* ‚îÄ‚îÄ QUIZ SCREEN ‚îÄ‚îÄ */
  #screen-quiz {
    justify-content: flex-start;
    padding-top: 0;
    gap: 0;
  }

  .quiz-header {
    width: 100%; max-width: 420px;
    display: flex; align-items: center; justify-content: space-between;
    padding: 16px 4px 0;
    margin-bottom: 16px;
  }
  .quiz-cat {
    font-family: 'Syne', sans-serif;
    font-size: 13px; font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: var(--muted);
  }
  .quiz-counter {
    font-family: 'Syne', sans-serif;
    font-size: 13px; font-weight: 700;
    color: var(--ink);
    background: var(--card);
    border: 1.5px solid var(--ink);
    padding: 4px 12px;
    border-radius: 100px;
  }

  /* Progress bar */
  .progress-bar {
    width: 100%; max-width: 420px;
    height: 4px;
    background: rgba(26,20,16,0.12);
    border-radius: 100px;
    margin-bottom: 24px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: var(--ink);
    border-radius: 100px;
    transition: width 0.4s cubic-bezier(0.4,0,0.2,1);
  }

  /* Card */
  .card-stage {
    width: 100%; max-width: 420px;
    position: relative;
    height: 340px;
    perspective: 1000px;
  }

  .question-card {
    position: absolute; inset: 0;
    background: var(--card);
    border-radius: var(--radius);
    border: 2px solid var(--ink);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 32px 24px;
    box-shadow: 6px 6px 0 var(--ink);
    cursor: grab;
    user-select: none;
    transition: box-shadow 0.2s;
    will-change: transform;
  }
  .question-card:active { cursor: grabbing; }

  .card-label {
    font-size: 11px;
    font-weight: 500;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 32px;
  }

  .options-row {
    display: flex; align-items: center;
    gap: 16px;
    width: 100%;
  }

  /* Clickable options - now interactive */
  .opt {
    flex: 1;
    text-align: center;
    padding: 20px 12px;
    border-radius: 16px;
    border: 2px solid rgba(26,20,16,0.12);
    transition: all 0.18s cubic-bezier(0.34,1.56,0.64,1);
    position: relative;
    overflow: hidden;
    cursor: pointer;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
  }
  .opt:hover {
    border-color: rgba(26,20,16,0.3);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(26,20,16,0.08);
  }
  .opt:active, .opt.pressing {
    transform: scale(0.96);
  }
  .opt.chosen-left {
    background: rgba(46,204,122,0.15);
    border-color: var(--match);
    transform: scale(1.04);
  }
  .opt.chosen-right {
    background: rgba(46,204,122,0.15);
    border-color: var(--match);
    transform: scale(1.04);
  }

  .opt-text {
    font-family: 'Syne', sans-serif;
    font-size: clamp(12px, 3.5vw, 18px);
    font-weight: 700;
    color: var(--ink);
    line-height: 1.2;
    word-break: break-word;
    hyphens: auto;
  }
  .opt-emoji {
    font-size: 28px;
    margin-bottom: 8px;
    display: block;
  }

  .or-badge {
    width: 36px; height: 36px;
    background: var(--ink);
    color: var(--bg);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Syne', sans-serif;
    font-size: 11px; font-weight: 800;
    letter-spacing: 0.5px;
    flex-shrink: 0;
  }

  /* Swipe hint labels on card */
  .swipe-hint {
    position: absolute;
    top: 20px;
    font-family: 'Syne', sans-serif;
    font-size: 13px; font-weight: 800;
    letter-spacing: 1px;
    text-transform: uppercase;
    opacity: 0;
    transition: opacity 0.1s;
    padding: 6px 14px;
    border-radius: 8px;
    border: 2px solid;
  }
  .swipe-hint.left { left: 16px; color: var(--accent); border-color: var(--accent); background: rgba(255,107,53,0.08); }
  .swipe-hint.right { right: 16px; color: var(--match); border-color: var(--match); background: rgba(46,204,122,0.08); }
  .swipe-hint.up { top: 16px; left: 50%; transform: translateX(-50%); color: var(--muted); border-color: var(--muted); white-space: nowrap; background: rgba(176,168,156,0.1); }

  /* ‚îÄ‚îÄ BOTTOM ACTION BAR ‚îÄ‚îÄ */
  .action-bar {
    display: flex;
    gap: 28px;
    margin-top: 28px;
    align-items: flex-start;
    justify-content: center;
  }
  .action-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    -webkit-tap-highlight-color: transparent;
  }
  .action-circle {
    width: 60px; height: 60px;
    border-radius: 50%;
    border: 2.5px solid var(--ink);
    background: var(--card);
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
    transition: all 0.18s cubic-bezier(0.34,1.56,0.64,1);
    box-shadow: 3px 3px 0 var(--ink);
    user-select: none;
  }
  .action-circle:hover { transform: translate(-1px,-2px); box-shadow: 4px 5px 0 var(--ink); }
  .action-circle:active { transform: translate(1px,1px); box-shadow: 1px 1px 0 var(--ink); }
  .action-circle.liked {
    background: var(--accent2);
    border-color: var(--ink);
    animation: pop 0.3s cubic-bezier(0.34,1.56,0.64,1);
  }
  @keyframes pop {
    0% { transform: scale(1); }
    50% { transform: scale(1.25); }
    100% { transform: scale(1); }
  }
  .action-label {
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    font-weight: 700;
    color: var(--ink);
    letter-spacing: 0.3px;
    text-align: center;
  }
  .action-item.skip-btn .action-circle {
    font-size: 18px;
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    color: var(--ink);
  }

  /* ‚îÄ‚îÄ BURGER MENU ‚îÄ‚îÄ */
  .burger-btn {
    position: fixed;
    top: 16px; right: 16px;
    width: 44px; height: 44px;
    border-radius: 12px;
    background: var(--ink);
    border: none;
    cursor: pointer;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 5px;
    z-index: 200;
    transition: all 0.18s;
    -webkit-tap-highlight-color: transparent;
  }
  .burger-btn:hover { transform: translate(-1px,-1px); }
  .burger-btn span {
    display: block;
    width: 18px; height: 2px;
    background: var(--bg);
    border-radius: 2px;
    transition: all 0.3s;
  }
  .burger-btn.open span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
  .burger-btn.open span:nth-child(2) { opacity: 0; transform: scaleX(0); }
  .burger-btn.open span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

  /* Drawer overlay */
  .drawer-overlay {
    position: fixed; inset: 0;
    background: rgba(26,20,16,0.4);
    z-index: 190;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s;
    backdrop-filter: blur(2px);
  }
  .drawer-overlay.open { opacity: 1; pointer-events: all; }

  /* Drawer panel */
  .drawer {
    position: fixed;
    top: 0; right: 0; bottom: 0;
    width: min(300px, 85vw);
    background: var(--card);
    border-left: 2px solid var(--ink);
    z-index: 195;
    transform: translateX(100%);
    transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
    display: flex; flex-direction: column;
    padding: 0;
    box-shadow: -8px 0 40px rgba(26,20,16,0.15);
  }
  .drawer.open { transform: translateX(0); }

  .drawer-header {
    padding: 20px 24px 16px;
    border-bottom: 1.5px solid rgba(26,20,16,0.08);
    display: flex; align-items: center; gap: 12px;
  }
  .drawer-logo {
    width: 36px; height: 36px;
    background: var(--ink); border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 3px 3px 0 var(--accent);
  }
  .drawer-logo svg { width: 20px; height: 20px; }
  .drawer-title {
    font-family: 'Syne', sans-serif;
    font-size: 20px; font-weight: 800;
    color: var(--ink); letter-spacing: -0.5px;
  }

  .drawer-nav {
    flex: 1; padding: 16px 0;
    overflow-y: auto;
  }
  .drawer-item {
    display: flex; align-items: center; gap: 16px;
    padding: 14px 24px;
    cursor: pointer;
    transition: background 0.15s;
    border-radius: 0;
    -webkit-tap-highlight-color: transparent;
  }
  .drawer-item:hover { background: rgba(26,20,16,0.04); }
  .drawer-item.active { background: rgba(255,107,53,0.08); }
  .drawer-icon {
    width: 40px; height: 40px;
    border-radius: 12px;
    background: var(--bg);
    border: 1.5px solid rgba(26,20,16,0.12);
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
    flex-shrink: 0;
  }
  .drawer-item-text { flex: 1; }
  .drawer-item-label {
    font-family: 'Syne', sans-serif;
    font-size: 15px; font-weight: 700;
    color: var(--ink);
  }
  .drawer-item-sub {
    font-size: 12px; color: var(--muted);
    margin-top: 1px;
  }
  .drawer-badge {
    background: var(--accent);
    color: white;
    font-family: 'Syne', sans-serif;
    font-size: 11px; font-weight: 700;
    padding: 2px 8px;
    border-radius: 100px;
    min-width: 20px;
    text-align: center;
  }

  .drawer-section-title {
    padding: 12px 24px 4px;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 1.5px;
    text-transform: uppercase;
    color: var(--muted);
  }

  .drawer-footer {
    padding: 16px 24px;
    border-top: 1.5px solid rgba(26,20,16,0.08);
    font-size: 11px;
    color: var(--muted);
    text-align: center;
  }

  /* ‚îÄ‚îÄ MENU SCREENS (Matches, Messages, Settings) ‚îÄ‚îÄ */
  .panel-screen {
    position: fixed; inset: 0;
    background: var(--bg);
    z-index: 180;
    transform: translateX(100%);
    transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
    display: flex; flex-direction: column;
    overflow: hidden;
  }
  .panel-screen.open { transform: translateX(0); }

  .panel-header {
    display: flex; align-items: center; gap: 12px;
    padding: 56px 20px 16px;
    border-bottom: 1.5px solid rgba(26,20,16,0.1);
    background: var(--card);
  }
  .panel-back {
    width: 36px; height: 36px;
    border-radius: 10px;
    border: 2px solid var(--ink);
    background: transparent;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
    flex-shrink: 0;
    transition: all 0.15s;
  }
  .panel-back:hover { background: var(--ink); color: var(--bg); }
  .panel-title {
    font-family: 'Syne', sans-serif;
    font-size: 22px; font-weight: 800;
    color: var(--ink); letter-spacing: -0.5px;
  }
  .panel-body {
    flex: 1; overflow-y: auto;
    padding: 20px;
  }

  /* Match list items */
  .match-list-item {
    background: var(--card);
    border: 2px solid var(--ink);
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 12px;
    box-shadow: 3px 3px 0 var(--ink);
    display: flex; gap: 14px; align-items: center;
    cursor: pointer;
    transition: all 0.15s;
  }
  .match-list-item:hover { transform: translate(-1px,-1px); box-shadow: 4px 4px 0 var(--ink); }
  .match-cat-icon {
    width: 48px; height: 48px;
    border-radius: 12px;
    background: var(--bg);
    border: 1.5px solid rgba(26,20,16,0.12);
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
    flex-shrink: 0;
  }
  .match-info { flex: 1; }
  .match-info-title {
    font-family: 'Syne', sans-serif;
    font-size: 15px; font-weight: 700;
    color: var(--ink);
  }
  .match-info-sub { font-size: 12px; color: var(--muted); margin-top: 2px; }
  .match-pct-badge {
    font-family: 'Syne', sans-serif;
    font-size: 16px; font-weight: 800;
    color: var(--ink);
  }

  /* Messages */
  .msg-list-item {
    background: var(--card);
    border: 2px solid var(--ink);
    border-radius: 16px;
    padding: 14px 16px;
    margin-bottom: 10px;
    display: flex; gap: 12px; align-items: center;
    cursor: pointer;
    transition: all 0.15s;
    box-shadow: 3px 3px 0 var(--ink);
  }
  .msg-list-item:hover { transform: translate(-1px,-1px); box-shadow: 4px 4px 0 var(--ink); }
  .msg-avatar {
    width: 44px; height: 44px;
    border-radius: 50%;
    background: var(--accent2);
    border: 2px solid var(--ink);
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
  }
  .msg-info { flex: 1; min-width: 0; }
  .msg-name {
    font-family: 'Syne', sans-serif;
    font-size: 14px; font-weight: 700;
    color: var(--ink);
  }
  .msg-preview {
    font-size: 12px; color: var(--muted);
    margin-top: 2px;
    white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  }
  .msg-time { font-size: 11px; color: var(--muted); flex-shrink: 0; }
  .msg-unread {
    width: 8px; height: 8px;
    border-radius: 50%;
    background: var(--accent);
    flex-shrink: 0;
    align-self: center;
  }

  /* Chat view */
  .chat-header {
    display: flex; align-items: center; gap: 12px;
    padding: 56px 20px 16px;
    border-bottom: 1.5px solid rgba(26,20,16,0.1);
    background: var(--card);
  }
  .chat-messages {
    flex: 1; overflow-y: auto;
    padding: 16px 20px;
    display: flex; flex-direction: column; gap: 10px;
  }
  .chat-bubble {
    max-width: 72%;
    padding: 10px 14px;
    border-radius: 16px;
    font-size: 14px;
    line-height: 1.4;
    word-break: break-word;
  }
  .chat-bubble.me {
    background: var(--ink);
    color: var(--bg);
    align-self: flex-end;
    border-bottom-right-radius: 4px;
  }
  .chat-bubble.them {
    background: var(--card);
    border: 1.5px solid rgba(26,20,16,0.12);
    color: var(--ink);
    align-self: flex-start;
    border-bottom-left-radius: 4px;
  }
  .chat-input-bar {
    padding: 12px 16px;
    border-top: 1.5px solid rgba(26,20,16,0.1);
    background: var(--card);
    display: flex; gap: 10px; align-items: center;
  }
  .chat-input {
    flex: 1;
    padding: 10px 14px;
    border-radius: 100px;
    border: 1.5px solid rgba(26,20,16,0.2);
    background: var(--bg);
    font-family: 'DM Sans', sans-serif;
    font-size: 14px;
    outline: none;
  }
  .chat-input:focus { border-color: var(--ink); }
  .chat-send {
    width: 40px; height: 40px;
    border-radius: 50%;
    background: var(--ink);
    border: none;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
    transition: all 0.15s;
    flex-shrink: 0;
  }
  .chat-send:hover { background: #333; }

  /* Settings */
  .settings-section {
    background: var(--card);
    border: 2px solid var(--ink);
    border-radius: 16px;
    margin-bottom: 16px;
    overflow: hidden;
    box-shadow: 3px 3px 0 var(--ink);
  }
  .settings-item {
    display: flex; align-items: center; gap: 14px;
    padding: 14px 16px;
    border-bottom: 1px solid rgba(26,20,16,0.06);
    cursor: pointer;
    transition: background 0.15s;
  }
  .settings-item:last-child { border-bottom: none; }
  .settings-item:hover { background: rgba(26,20,16,0.03); }
  .settings-item-icon { font-size: 20px; }
  .settings-item-label {
    flex: 1;
    font-family: 'Syne', sans-serif;
    font-size: 14px; font-weight: 600;
    color: var(--ink);
  }
  .settings-item-value {
    font-size: 13px; color: var(--muted);
  }
  .settings-toggle {
    width: 40px; height: 22px;
    border-radius: 100px;
    background: rgba(26,20,16,0.15);
    border: none;
    cursor: pointer;
    position: relative;
    transition: background 0.2s;
  }
  .settings-toggle.on { background: var(--match); }
  .settings-toggle::after {
    content: '';
    position: absolute;
    top: 3px; left: 3px;
    width: 16px; height: 16px;
    border-radius: 50%;
    background: white;
    transition: transform 0.2s;
  }
  .settings-toggle.on::after { transform: translateX(18px); }

  /* Empty state */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
  }
  .empty-state-icon { font-size: 48px; margin-bottom: 16px; }
  .empty-state-title {
    font-family: 'Syne', sans-serif;
    font-size: 20px; font-weight: 800;
    color: var(--ink); margin-bottom: 8px;
  }
  .empty-state-sub { font-size: 14px; color: var(--muted); line-height: 1.6; }

  /* New question modal */
  .modal-overlay {
    position: fixed; inset: 0;
    background: rgba(26,20,16,0.5);
    z-index: 300;
    display: flex; align-items: flex-end; justify-content: center;
    opacity: 0; pointer-events: none;
    transition: opacity 0.3s;
    backdrop-filter: blur(3px);
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal-sheet {
    background: var(--card);
    border-radius: 24px 24px 0 0;
    border: 2px solid var(--ink);
    border-bottom: none;
    width: 100%; max-width: 480px;
    padding: 24px 24px 40px;
    transform: translateY(100%);
    transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
    box-shadow: 0 -8px 40px rgba(26,20,16,0.15);
  }
  .modal-overlay.open .modal-sheet { transform: translateY(0); }
  .modal-handle {
    width: 36px; height: 4px;
    background: rgba(26,20,16,0.2);
    border-radius: 2px;
    margin: 0 auto 20px;
  }
  .modal-title {
    font-family: 'Syne', sans-serif;
    font-size: 20px; font-weight: 800;
    color: var(--ink); margin-bottom: 20px;
  }
  .modal-input {
    width: 100%;
    padding: 12px 16px;
    border-radius: 12px;
    border: 2px solid rgba(26,20,16,0.2);
    background: var(--bg);
    font-family: 'DM Sans', sans-serif;
    font-size: 15px;
    outline: none;
    margin-bottom: 12px;
    transition: border-color 0.15s;
  }
  .modal-input:focus { border-color: var(--ink); }
  .modal-inputs-row {
    display: flex; gap: 10px; margin-bottom: 16px;
  }
  .modal-inputs-row .modal-input { margin-bottom: 0; }
  .modal-cat-select {
    width: 100%;
    padding: 12px 16px;
    border-radius: 12px;
    border: 2px solid rgba(26,20,16,0.2);
    background: var(--bg);
    font-family: 'Syne', sans-serif;
    font-size: 14px; font-weight: 600;
    color: var(--ink);
    outline: none;
    margin-bottom: 16px;
    cursor: pointer;
  }

  /* highlight-left/right for swipe */
  .opt.highlight-left { background: rgba(255,107,53,0.12); border-color: var(--accent); }
  .opt.highlight-right { background: rgba(46,204,122,0.12); border-color: var(--match); }
  #screen-match { gap: 0; text-align: center; }

  .match-score-ring {
    width: 160px; height: 160px;
    position: relative;
    margin: 0 auto 28px;
  }
  .match-score-ring svg { transform: rotate(-90deg); }
  .ring-bg { fill: none; stroke: rgba(26,20,16,0.1); stroke-width: 10; }
  .ring-fg { fill: none; stroke: var(--match); stroke-width: 10; stroke-linecap: round;
    stroke-dasharray: 440; stroke-dashoffset: 440;
    transition: stroke-dashoffset 1.5s cubic-bezier(0.4,0,0.2,1);
  }
  .ring-text {
    position: absolute; inset: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
  }
  .ring-pct {
    font-family: 'Syne', sans-serif;
    font-size: 40px; font-weight: 800;
    color: var(--ink); line-height: 1;
  }
  .ring-label {
    font-size: 11px; color: var(--muted);
    letter-spacing: 1px; text-transform: uppercase;
    font-weight: 500;
  }

  .match-title {
    font-family: 'Syne', sans-serif;
    font-size: 28px; font-weight: 800;
    color: var(--ink); margin-bottom: 8px;
    letter-spacing: -0.5px;
  }
  .match-subtitle {
    font-size: 14px; color: var(--muted);
    margin-bottom: 32px; line-height: 1.6;
    max-width: 280px;
  }

  /* Results list */
  .results-scroll {
    width: 100%; max-width: 420px;
    max-height: 260px;
    overflow-y: auto;
    border-radius: 16px;
    border: 2px solid var(--ink);
    background: var(--card);
    margin-bottom: 24px;
    scrollbar-width: thin;
  }
  .result-item {
    display: grid; grid-template-columns: 1fr 28px 1fr;
    align-items: center;
    padding: 10px 16px;
    border-bottom: 1px solid rgba(26,20,16,0.06);
    gap: 8px;
  }
  .result-item:last-child { border-bottom: none; }
  .result-a { text-align: right; font-size: 13px; font-weight: 500; color: var(--ink); }
  .result-b { text-align: left; font-size: 13px; font-weight: 500; color: var(--ink); }
  .result-a.winner { color: var(--match); font-weight: 700; }
  .result-b.winner { color: var(--match); font-weight: 700; }
  .result-dot {
    width: 16px; height: 16px;
    border-radius: 50%;
    margin: 0 auto;
  }
  .dot-match { background: var(--match); }
  .dot-nomatch { background: var(--nomatch); }
  .dot-skip { background: var(--skip); }

  .results-legend {
    display: flex; gap: 16px; justify-content: center;
    margin-bottom: 24px; flex-wrap: wrap;
  }
  .legend-item {
    display: flex; align-items: center; gap: 6px;
    font-size: 12px; color: var(--muted);
  }
  .legend-dot {
    width: 10px; height: 10px; border-radius: 50%;
  }

  .btn-secondary {
    padding: 14px 32px;
    background: transparent;
    color: var(--ink);
    border: 2px solid var(--ink);
    border-radius: 100px;
    font-family: 'Syne', sans-serif;
    font-size: 14px; font-weight: 700;
    cursor: pointer;
    letter-spacing: 0.5px;
    transition: all 0.18s;
    margin-left: 12px;
  }
  .btn-secondary:hover { background: var(--ink); color: var(--bg); }

  .btn-row { display: flex; gap: 0; flex-wrap: wrap; justify-content: center; }

  /* Selected option highlight during swipe */
  .opt.highlight-left { background: rgba(255,107,53,0.12); border-color: var(--accent); }
  .opt.highlight-right { background: rgba(46,204,122,0.12); border-color: var(--match); }

  /* Confetti dots */
  .confetti-container {
    position: fixed; inset: 0; pointer-events: none; z-index: 100; overflow: hidden;
  }
  .confetti-dot {
    position: absolute;
    width: 8px; height: 8px;
    border-radius: 2px;
    animation: confetti-fall 1.2s ease-out forwards;
  }
  @keyframes confetti-fall {
    0% { opacity: 1; transform: translateY(-20px) rotate(0deg); }
    100% { opacity: 0; transform: translateY(100vh) rotate(720deg); }
  }

  /* Transition animations */
  @keyframes card-in {
    0% { opacity: 0; transform: scale(0.94) translateY(20px); }
    100% { opacity: 1; transform: scale(1) translateY(0); }
  }
  .card-animate-in { animation: card-in 0.35s cubic-bezier(0.34,1.56,0.64,1) forwards; }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

</style>
</head>
<body>

<!-- WELCOME SCREEN -->
<div class="screen" id="screen-welcome">
  <div class="logo-mark">
    <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="14" cy="14" r="7" fill="#FFD166"/>
      <circle cx="26" cy="26" r="7" fill="#FF6B35"/>
      <path d="M14 21 C14 21 18 26 26 19" stroke="#FFFDF8" stroke-width="2.5" stroke-linecap="round"/>
    </svg>
  </div>
  <h1>Alike</h1>
  <p class="tagline">Find out what you really have in common.</p>

  <div class="categories">
    <div class="cat-chip active" data-cat="Lifestyle">‚ú® Lifestyle</div>
    <div class="cat-chip" data-cat="Food">üçï Food</div>
    <div class="cat-chip" data-cat="Love">üíò Love</div>
    <div class="cat-chip" data-cat="Music">üéµ Music</div>
    <div class="cat-chip" data-cat="Travel">‚úàÔ∏è Travel</div>
    <div class="cat-chip" data-cat="Culture">üé≠ Culture</div>
    <div class="cat-chip" data-cat="Sports">‚öΩ Sports</div>
    <div class="cat-chip" data-cat="Values">üß≠ Values</div>
    <div class="cat-chip" data-cat="People">ü§ù People</div>
    <div class="cat-chip" data-cat="Future">üöÄ Future</div>
    <div class="cat-chip" data-cat="Popular">üî• Popular</div>
    <div class="cat-chip" data-cat="Random">üé≤ Random</div>
  </div>

  <button class="btn-primary" onclick="startQuiz()">Start Matching ‚Üí</button>
</div>

<!-- QUIZ SCREEN -->
<div class="screen hidden" id="screen-quiz">
  <div class="quiz-header">
    <div class="quiz-cat" id="quiz-cat-label">‚ú® Lifestyle</div>
    <div class="quiz-counter" id="quiz-counter">1 / 10</div>
  </div>
  <div class="progress-bar">
    <div class="progress-fill" id="progress-fill" style="width:10%"></div>
  </div>

  <div class="card-stage">
    <div class="question-card card-animate-in" id="question-card">
      <div class="swipe-hint left" id="hint-left">‚Üê This</div>
      <div class="swipe-hint right" id="hint-right">That ‚Üí</div>
      <div class="swipe-hint up" id="hint-up">‚Üë Skip</div>

      <div class="card-label">What do you prefer?</div>
      <div class="options-row">
        <div class="opt" id="opt-left" onclick="answerClick('left')">
          <span class="opt-emoji" id="opt-left-emoji">üåÖ</span>
          <div class="opt-text" id="opt-left-text">Early bird</div>
        </div>
        <div class="or-badge">OR</div>
        <div class="opt" id="opt-right" onclick="answerClick('right')">
          <span class="opt-emoji" id="opt-right-emoji">ü¶â</span>
          <div class="opt-text" id="opt-right-text">Night owl</div>
        </div>
      </div>
    </div>
  </div>

  <!-- New action bar: Like / Skip / New Question -->
  <div class="action-bar">
    <div class="action-item" onclick="likeQuestion()">
      <div class="action-circle" id="like-btn">üëç</div>
      <div class="action-label">Nice one</div>
    </div>
    <div class="action-item skip-btn" onclick="answer('skip')">
      <div class="action-circle" style="font-size:17px; font-weight:800; font-family:'Syne',sans-serif;">>></div>
      <div class="action-label">Skip</div>
    </div>
    <div class="action-item" onclick="openNewQuestionModal()">
      <div class="action-circle">Ôºã</div>
      <div class="action-label">New question</div>
    </div>
  </div>
</div>

<!-- SHARE SCREEN (Person A invites Person B) -->
<div class="screen hidden" id="screen-share">
  <div class="logo-mark" style="margin-bottom:20px">
    <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="14" cy="14" r="7" fill="#FFD166"/>
      <circle cx="26" cy="26" r="7" fill="#FF6B35"/>
      <path d="M14 21 C14 21 18 26 26 19" stroke="#FFFDF8" stroke-width="2.5" stroke-linecap="round"/>
    </svg>
  </div>
  <div class="match-title">‚ú® Profile Complete!</div>
  <div class="match-subtitle" style="max-width:320px">You've answered all questions. Now invite a friend to see how you match!</div>

  <div style="background:var(--card); border:2px solid var(--ink); border-radius:16px; padding:20px; max-width:380px; margin:24px 0;">
    <div style="font-size:11px; font-weight:600; letter-spacing:1px; text-transform:uppercase; color:var(--muted); margin-bottom:8px;">Your Match Link</div>
    <div style="display:flex; gap:8px; align-items:center;">
      <input type="text" id="share-link" readonly style="flex:1; padding:10px 14px; border:1.5px solid rgba(26,20,16,0.2); border-radius:10px; font-size:13px; font-family:'DM Sans',sans-serif; background:var(--bg);" value="">
      <button class="action-btn" onclick="copyLink()" title="Copy link" style="flex-shrink:0;">üìã</button>
    </div>
    <div id="copy-feedback" style="font-size:11px; color:var(--match); margin-top:8px; opacity:0; transition:opacity 0.3s;">‚úì Link copied!</div>
  </div>

  <div class="btn-row">
    <button class="btn-primary" onclick="shareNative()">Share Link ‚Üí</button>
    <button class="btn-secondary" onclick="goHome()">‚Üê Home</button>
  </div>
</div>

<!-- WAITING SCREEN (Person A waits for Person B) -->
<div class="screen hidden" id="screen-waiting">
  <div class="logo-mark" style="margin-bottom:20px; animation: pulse 2s ease-in-out infinite;">
    <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
      <circle cx="14" cy="14" r="7" fill="#FFD166"/>
      <circle cx="26" cy="26" r="7" fill="#FF6B35"/>
      <path d="M14 21 C14 21 18 26 26 19" stroke="#FFFDF8" stroke-width="2.5" stroke-linecap="round"/>
    </svg>
  </div>
  <div class="match-title">‚è≥ Waiting for your match...</div>
  <div class="match-subtitle" style="max-width:320px">We'll show your results as soon as they finish answering!</div>
  
  <button class="btn-primary" onclick="checkMatch()" style="margin-top:24px;">Check Status</button>
  <button class="btn-secondary" onclick="goHome()">‚Üê Home</button>
</div>

<!-- MATCH SCREEN -->
<div class="screen hidden" id="screen-match">
  <div class="match-score-ring">
    <svg width="160" height="160" viewBox="0 0 160 160">
      <circle class="ring-bg" cx="80" cy="80" r="70"/>
      <circle class="ring-fg" id="ring-fg" cx="80" cy="80" r="70"/>
    </svg>
    <div class="ring-text">
      <div class="ring-pct" id="match-pct">0%</div>
      <div class="ring-label">Match</div>
    </div>
  </div>

  <div class="match-title" id="match-verdict">Great Match!</div>
  <div class="match-subtitle" id="match-desc">You and your friend share lots of tastes. Lots to talk about!</div>

  <div class="results-legend">
    <div class="legend-item"><div class="legend-dot" style="background:var(--match)"></div> Same taste</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--nomatch)"></div> Different</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--skip)"></div> Skipped</div>
  </div>

  <div class="results-scroll" id="results-list"></div>

  <div class="btn-row">
    <button class="btn-primary" onclick="restartQuiz()">Play Again</button>
    <button class="btn-secondary" onclick="goHome()">‚Üê Home</button>
  </div>
</div>

<div class="confetti-container" id="confetti-container"></div>

<script>
const QUESTIONS = {
  Lifestyle: [
    {l:'üåÖ Early bird', r:'ü¶â Night owl'},
    {l:'üì± Phone first thing', r:'‚òï Coffee first thing'},
    {l:'üè† Stay in', r:'üéâ Go out'},
    {l:'üìö Read', r:'üì∫ Watch TV'},
    {l:'üßπ Tidy freak', r:'üåÄ Organized chaos'},
    {l:'üßò Slow mornings', r:'‚ö° Rush mornings'},
    {l:'üí∞ Save money', r:'üõçÔ∏è Spend money'},
    {l:'üêï Dog person', r:'üêà Cat person'},
    {l:'üåø Minimalist', r:'üé® Maximalist'},
    {l:'üìÖ Planner', r:'üé≤ Improviser'},
    {l:'üèôÔ∏è City life', r:'üåæ Country life'},
    {l:'üßÉ Healthy habits', r:'üç© Treat yourself'},
    {l:'üß† Logic', r:'‚ù§Ô∏è Feelings'},
    {l:'üó£Ô∏è Talk it out', r:'‚úçÔ∏è Write it out'},
    {l:'üëØ Social butterfly', r:'üê¢ Homebody'},
    {l:'üëü Sneakers', r:'üë† Dressed up'},
    {l:'üëï Casual style', r:'üëî Put-together style'},
    {l:'üñ§ Black always', r:'üåà Color lover'},
    {l:'üëú Designer bag', r:'üéí Backpack'},
    {l:'üìè Fitted clothes', r:'üõãÔ∏è Oversized'},
    {l:'üß¥ Skincare routine', r:'üíß Soap & water'},
    {l:'üõí Shop often', r:'üëö Wear what you have'},
  ],
  Food: [
    {l:'üç≥ Cooking', r:'üì± Ordering in'},
    {l:'ü•Ç Fancy restaurant', r:'üç∫ Casual spot'},
    {l:'üç£ Sushi', r:'üçï Pizza'},
    {l:'‚òï Black coffee', r:'üßã Oat latte'},
    {l:'ü•© Meat', r:'ü•¶ Vegetarian'},
    {l:'üçΩÔ∏è Three courses', r:'ü•ò Tapas to share'},
    {l:'ü•ö Scrambled eggs', r:'üç≥ Fried eggs'},
    {l:'ü´ñ Tea', r:'‚òï Coffee'},
    {l:'üç™ Cookies', r:'üéÇ Cake'},
    {l:'üç∫ Beer', r:'üç∑ Wine'},
    {l:'üáπüá≠ Thai', r:'üáÆüáπ Italian'},
    {l:'‚ö° Fast food', r:'üê¢ Slow food'},
    {l:'üßÇ Savory', r:'üçØ Sweet'},
    {l:'ü•ê Croissant', r:'ü•Ø Bagel'},
    {l:'üçî Burger', r:'üåÆ Tacos'},
    {l:'ü´ß Sparkling water', r:'üíß Still water'},
    {l:'ü•ó Light meal', r:'üçù Something filling'},
    {l:'üå∂Ô∏è Very spicy', r:'ü´ô Mild please'},
    {l:'üç´ Chocolate', r:'üç¨ Gummies'},
    {l:'ü•ò Home cooked', r:'üç± Takeaway box'},
  ],
  Love: [
    {l:'üíå Text first', r:'üìû Call first'},
    {l:'üåπ Grand gestures', r:'üåø Small everyday moments'},
    {l:'üè† Stay in date', r:'üåÜ Go out date'},
    {l:'üí¨ Talk about feelings', r:'ü§ê Show through actions'},
    {l:'üíè PDA', r:'üôà Keep it private'},
    {l:'üéÅ Give gifts', r:'‚è±Ô∏è Give time'},
    {l:'üîë Move in together early', r:'üè† Keep own place longer'},
    {l:'üì≤ Constant texting', r:'üìµ Space to breathe'},
    {l:'üíç Marriage', r:'ü§ù Commitment without it'},
    {l:'üë∂ Kids', r:'üêæ No kids'},
    {l:'‚ù§Ô∏è Fall fast', r:'üå± Take it slow'},
    {l:'ü´Ç Physical touch', r:'üó£Ô∏è Words of affirmation'},
    {l:'üìÖ Plan dates', r:'‚ú® Spontaneous dates'},
    {l:'üèñÔ∏è Couple trips', r:'üßç Solo trips too'},
    {l:'üéÇ Big birthday fuss', r:'üôÇ Low-key birthday'},
    {l:'üíë Best friends first', r:'‚ö° Chemistry first'},
    {l:'üîì Share everything', r:'üîê Keep some things private'},
    {l:'üò¥ Early to bed together', r:'üåô Different sleep schedules ok'},
  ],
  Music: [
    {l:'üé∏ Rock', r:'üé§ Pop'},
    {l:'üéß Headphones', r:'üì¢ Speakers'},
    {l:'üåÉ Live concert', r:'üè† Streaming at home'},
    {l:'üéº Lyrics matter', r:'ü•Å Beat matters'},
    {l:'üéπ Classical', r:'üé∑ Jazz'},
    {l:'üéµ One genre', r:'üé∂ All genres'},
    {l:'üìª Radio', r:'üéß Curated playlist'},
    {l:'üé§ Karaoke', r:'üôÖ Never karaoke'},
    {l:'üîä Loud', r:'üîà Background music'},
    {l:'üéª Old classics', r:'üÜï New releases'},
    {l:'üéôÔ∏è Podcasts', r:'üéµ Music only'},
    {l:'üï∫ Dance to it', r:'üß† Really listen'},
    {l:'üíø Full albums', r:'üéµ Just the singles'},
    {l:'ü™ó Acoustic', r:'‚ö° Electronic'},
    {l:'üé§ Follow the artist', r:'üéöÔ∏è Follow the producer'},
    {l:'üéª One instrument', r:'üé∏ Full band'},
  ],
  Travel: [
    {l:'üèñÔ∏è Beach', r:'‚õ∞Ô∏è Mountains'},
    {l:'‚úàÔ∏è Fly', r:'üöÇ Train'},
    {l:'üè® Hotel', r:'üèïÔ∏è Camping'},
    {l:'üó∫Ô∏è Plan ahead', r:'üé≤ Just go'},
    {l:'üåç Far away', r:'üè° Close to home'},
    {l:'üåÜ City trip', r:'üåø Nature escape'},
    {l:'üçΩÔ∏è Local food always', r:'üçî Familiar comfort food'},
    {l:'üì∏ Famous sights', r:'üîç Hidden gems'},
    {l:'üß≥ Overpack', r:'üëú One carry-on'},
    {l:'üõéÔ∏è All-inclusive', r:'üó∫Ô∏è DIY adventure'},
    {l:'üßë‚Äçü§ù‚Äçüßë Travel with friends', r:'üßç Solo travel'},
    {l:'üåû Summer holiday', r:'‚ùÑÔ∏è Winter escape'},
    {l:'üèõÔ∏è History & culture', r:'üé¢ Fun & thrills'},
    {l:'üõ•Ô∏è Cruise', r:'üöê Road trip'},
    {l:'üåè New destination every time', r:'üîÅ Return to favorites'},
    {l:'üåÖ Sunrise hike', r:'üåÉ Nightlife explorer'},
  ],
  Culture: [
    {l:'üòÇ Comedy', r:'üò∞ Thriller'},
    {l:'üé¨ Cinema', r:'üõãÔ∏è Sofa stream'},
    {l:'ü¶∏ Blockbuster', r:'üé≠ Arthouse'},
    {l:'üîÆ Fantasy', r:'üöÄ Sci-Fi'},
    {l:'üò¢ Sad ending', r:'üòä Happy ending'},
    {l:'üì∫ Series', r:'üé¨ Films'},
    {l:'üéÆ Gaming', r:'üìö Reading'},
    {l:'üé≠ Theater', r:'üé§ Stand-up comedy'},
    {l:'üîä True crime', r:'üìñ Literary fiction'},
    {l:'üì° Documentary', r:'ü§£ Reality TV'},
    {l:'üóìÔ∏è One episode a week', r:'üì¶ Binge it all'},
    {l:'üñºÔ∏è Art museum', r:'üî¨ Science museum'},
    {l:'üì∞ Read the news', r:'üéôÔ∏è Hear the news'},
    {l:'üìñ Physical books', r:'üì± E-reader'},
    {l:'üé® Contemporary art', r:'üèõÔ∏è Classical art'},
    {l:'üåç Foreign films', r:'üá∫üá∏ Domestic films'},
    {l:'‚úçÔ∏è Fiction', r:'üìã Non-fiction'},
    {l:'üé™ Go to an exhibition', r:'üè† Watch a doc instead'},
  ],
  Sports: [
    {l:'‚öΩ Football', r:'üèÄ Basketball'},
    {l:'üèä Swimming', r:'üèÉ Running'},
    {l:'üì∫ Watch sport', r:'ü§∏ Play sport'},
    {l:'üèãÔ∏è Gym', r:'üßò Yoga'},
    {l:'ü§ù Team sport', r:'üèÉ Solo sport'},
    {l:'üåÖ Morning workout', r:'üåô Evening workout'},
    {l:'üèÜ Competitive', r:'üéâ Just for fun'},
    {l:'‚õ∑Ô∏è Winter sport', r:'üèÑ Summer sport'},
    {l:'üéØ Precision', r:'üí® Speed'},
    {l:'üåø Outdoors', r:'üè¢ Indoors'},
    {l:'üéæ Tennis', r:'üè∏ Badminton'},
    {l:'üßó Climbing', r:'üö¥ Cycling'},
    {l:'ü•ä Boxing', r:'ü•ã Martial arts'},
    {l:'üìä Stats & tactics', r:'‚ù§Ô∏è Pure passion'},
    {l:'üèüÔ∏è Stadium atmosphere', r:'üì∫ Couch & snacks'},
    {l:'ü•§ Energy drink', r:'üíß Just water'},
  ],
  Values: [
    {l:'üîí Security', r:'üåä Freedom'},
    {l:'üè† Roots & stability', r:'‚úàÔ∏è Change & adventure'},
    {l:'üë®‚Äçüë©‚Äçüëß Family first', r:'üßç Self first'},
    {l:'üíº Career driven', r:'‚è∏Ô∏è Work to live'},
    {l:'üí∞ Financial success', r:'üòä Personal happiness'},
    {l:'üå± Environment matters most', r:'üìà Progress matters most'},
    {l:'ü§ù Loyalty above all', r:'üîì Honesty above all'},
    {l:'üß† Head', r:'‚ù§Ô∏è Heart'},
    {l:'üìú Tradition', r:'üÜï Innovation'},
    {l:'üåç Think global', r:'üè° Act local'},
    {l:'üéØ Achievement', r:'üåø Contentment'},
    {l:'‚öñÔ∏è Justice', r:'üïäÔ∏è Peace'},
    {l:'üó≥Ô∏è Civic duty', r:'üôè Personal morality'},
    {l:'üí™ Self-reliance', r:'ü§≤ Community'},
    {l:'üî¨ Science & reason', r:'üåå Intuition & spirit'},
    {l:'üì£ Speak your mind', r:'ü§´ Choose your battles'},
  ],
  People: [
    {l:'üëØ Many friends', r:'üíé Few close ones'},
    {l:'üÜï Meet new people', r:'üîÅ Stick with who you know'},
    {l:'üí¨ Deep talks', r:'üòÑ Easy banter'},
    {l:'üéâ Be the host', r:'üôå Be the guest'},
    {l:'üìû Keep in touch often', r:'üåä Pick up where you left off'},
    {l:'üò§ Address conflict directly', r:'üòå Let it go'},
    {l:'ü§ó Hug hello', r:'üëã Wave hello'},
    {l:'üß† Smart friends', r:'üòÇ Funny friends'},
    {l:'ü´Ç Emotionally supportive', r:'üõ†Ô∏è Practically helpful'},
    {l:'üéÇ Remember every birthday', r:'üôà Terrible with dates'},
    {l:'üó£Ô∏è Advice giver', r:'üëÇ Listener'},
    {l:'üåç International circle', r:'üèòÔ∏è Local community'},
    {l:'üì± Always reachable', r:'üîï Respond when I can'},
    {l:'ü§ù Colleague = friend', r:'üìÇ Keep work & life separate'},
    {l:'üò∂ Need time to open up', r:'üòä Open book immediately'},
    {l:'ü•Ç Celebrate everything', r:'üôÇ Low-key by default'},
  ],
  Future: [
    {l:'ü§ñ AI will save us', r:'‚ö†Ô∏è AI is dangerous'},
    {l:'üöÄ Mars colony is exciting', r:'üåç Fix Earth first'},
    {l:'‚ôæÔ∏è Live forever if you could', r:'üåø Natural lifespan is enough'},
    {l:'üß¨ Edit your genes', r:'üôÖ Leave nature alone'},
    {l:'üèôÔ∏è Megacities', r:'üåæ Back to nature'},
    {l:'‚ö° Tech optimist', r:'üåßÔ∏è Tech pessimist'},
    {l:'ü§ù Universal basic income', r:'üíº Work for what you earn'},
    {l:'üåê One world government', r:'üó∫Ô∏è Nations stay separate'},
    {l:'üß† Upload your mind', r:'üíÄ Death is part of life'},
    {l:'üöó Self-driving everywhere', r:'üö∂ I\'ll drive myself'},
    {l:'üè• Designer babies ok', r:'üôè Not for humans to decide'},
    {l:'üå± Veganism saves the planet', r:'ü•© Technology saves the planet'},
    {l:'ü§ñ Robots do all the work', r:'üôå Humans need meaningful work'},
    {l:'üì° Contact aliens', r:'ü§´ Maybe don\'t'},
    {l:'üíä Enhance your brain', r:'üßò Train your brain naturally'},
    {l:'üåä Climate change is solvable', r:'üò∞ Climate change is irreversible'},
  ],
};

// All real categories for Random/Popular
const ALL_CATEGORIES = ['Lifestyle','Food','Love','Music','Travel','Culture','Sports','Values','People','Future'];

// Randomly flip left/right sides so answers aren't always predictable
function shuffleSides(qs) {
  return qs.map(q => Math.random() > 0.5 ? {l: q.r, r: q.l, _cat: q._cat, _catIdx: q._catIdx} : {...q});
}

function getRandomQuestions() {
  const pool = [];
  ALL_CATEGORIES.forEach(cat => {
    QUESTIONS[cat].forEach(q => pool.push({...q, _cat: cat}));
  });
  return shuffleSides(pool.sort(() => Math.random() - 0.5).slice(0, 20));
}

// Popular: questions sorted by likes (stored in localStorage)
function getPopularQuestions() {
  const pool = [];
  ALL_CATEGORIES.forEach(cat => {
    QUESTIONS[cat].forEach((q, i) => {
      const key = `likes_${cat}_${i}`;
      const likes = parseInt(localStorage.getItem(key) || '0');
      pool.push({...q, _cat: cat, _catIdx: i, _likes: likes});
    });
  });
  pool.sort((a, b) => b._likes - a._likes);
  const top = pool.slice(0, 20);
  return top;
}

const CATEGORY_EMOJI = {
  Lifestyle:'‚ú®', Food:'üçï', Love:'üíò', Music:'üéµ',
  Travel:'‚úàÔ∏è', Culture:'üé≠', Sports:'‚öΩ', Values:'üß≠',
  People:'ü§ù', Future:'üöÄ', Random:'üé≤', Popular:'üî•'
};

let currentCat = 'Food';
let questions = [];
let currentIdx = 0;
let myAnswers = [];
let matchId = null;
let isPersonB = false;

// Drag state
let isDragging = false;
let startX = 0, startY = 0;
let currentX = 0, currentY = 0;
let card;

// ========== INITIALIZATION ==========

window.onload = function() {
  const params = new URLSearchParams(window.location.search);
  const cat = params.get('cat');
  const qdata = params.get('qdata');
  const answersA = params.get('a');
  const answersB = params.get('b');

  if (cat && qdata) {
    isPersonB = !!answersA && !answersB;
    currentCat = cat;

    try {
      questions = JSON.parse(decodeURIComponent(atob(qdata)));
    } catch(e) {
      questions = [];
    }

    if (answersA && answersB) {
      const match = {
        category: currentCat,
        questions: questions,
        personA: answersA.split('').map(c => c === 'l' ? 'left' : c === 'r' ? 'right' : 'skip'),
        personB: answersB.split('').map(c => c === 'l' ? 'left' : c === 'r' ? 'right' : 'skip')
      };
      showResultsForBoth(match);
    } else if (answersA && !answersB) {
      currentIdx = 0;
      myAnswers = [];
      document.getElementById('quiz-cat-label').textContent = CATEGORY_EMOJI[currentCat] + ' ' + currentCat;
      renderQuestion();
      show('screen-quiz');
    }
  }
};

// ========== NAVIGATION ==========

function goHome() {
  isPersonB = false;
  matchId = null;
  window.history.pushState({}, '', window.location.pathname);
  show('screen-welcome');
}

function startQuiz() {
  currentCat = document.querySelector('.cat-chip.active')?.dataset.cat || 'Lifestyle';
  
  if (currentCat === 'Random') {
    questions = getRandomQuestions();
  } else if (currentCat === 'Popular') {
    questions = shuffleSides(getPopularQuestions());
  } else {
    const picked = [...QUESTIONS[currentCat]].sort(() => Math.random() - 0.5).slice(0, Math.min(20, QUESTIONS[currentCat].length));
    questions = shuffleSides(picked);
  }

  currentIdx = 0;
  myAnswers = [];
  isPersonB = false;
  matchId = null;

  document.getElementById('quiz-cat-label').textContent = CATEGORY_EMOJI[currentCat] + ' ' + currentCat;
  renderQuestion();
  show('screen-quiz');
}

// ========== QUIZ LOGIC ==========

function renderQuestion() {
  const q = questions[currentIdx];
  const [lEmoji, lText] = parseOption(q.l);
  const [rEmoji, rText] = parseOption(q.r);

  document.getElementById('opt-left-emoji').textContent = lEmoji;
  document.getElementById('opt-left-text').textContent = lText;
  document.getElementById('opt-right-emoji').textContent = rEmoji;
  document.getElementById('opt-right-text').textContent = rText;
  document.getElementById('quiz-counter').textContent = (currentIdx+1) + ' / ' + questions.length;
  document.getElementById('progress-fill').style.width = ((currentIdx+1)/questions.length*100) + '%';

  // Reset hints
  document.getElementById('hint-left').textContent = '‚Üê ' + lText.split(' ').slice(-1)[0];
  document.getElementById('hint-right').textContent = rText.split(' ').slice(-1)[0] + ' ‚Üí';

  // Reset card
  card = document.getElementById('question-card');
  card.style.transform = '';
  card.style.transition = '';
  resetHints();
  card.classList.remove('card-animate-in');
  void card.offsetWidth;
  card.classList.add('card-animate-in');

  setupDrag();
}

function parseOption(str) {
  const match = str.match(/^([\u{1F300}-\u{1FFFF}][\uFE0F]?\s*)/u);
  if (match) {
    return [match[0].trim(), str.slice(match[0].length).trim()];
  }
  return ['', str];
}

function answer(choice) {
  myAnswers.push(choice);

  animateCardOut(choice, () => {
    currentIdx++;
    if (currentIdx >= questions.length) {
      finishQuiz();
    } else {
      renderQuestion();
    }
  });
}

function animateCardOut(direction, cb) {
  const c = document.getElementById('question-card');
  c.style.transition = 'transform 0.38s cubic-bezier(0.4,0,1,1), opacity 0.3s';
  if (direction === 'left') c.style.transform = 'translateX(-140%) rotate(-20deg)';
  else if (direction === 'right') c.style.transform = 'translateX(140%) rotate(20deg)';
  else c.style.transform = 'translateY(-120%) scale(0.9)';
  c.style.opacity = '0';
  setTimeout(cb, 380);
}

function finishQuiz() {
  if (isPersonB) {
    const params = new URLSearchParams(window.location.search);
    const answersStr = myAnswers.map(a => a[0]).join('');
    params.set('b', answersStr);

    const cat = params.get('cat');
    const answersA = params.get('a');

    let questionsData;
    try {
      questionsData = JSON.parse(decodeURIComponent(atob(params.get('qdata'))));
    } catch(e) {
      questionsData = questions;
    }

    const match = {
      category: cat,
      questions: questionsData,
      personA: answersA.split('').map(c => c === 'l' ? 'left' : c === 'r' ? 'right' : 'skip'),
      personB: answersStr.split('').map(c => c === 'l' ? 'left' : c === 'r' ? 'right' : 'skip')
    };

    window.history.replaceState({}, '', '?' + params.toString());
    showResultsForBoth(match);

  } else {
    // Person A ‚Äî encode questions as base64 (always, simplest & most reliable)
    const answersStr = myAnswers.map(a => a[0]).join('');
    const params = new URLSearchParams();
    params.set('cat', currentCat);
    params.set('a', answersStr);

    // Safe base64 encode that handles unicode/emoji
    const encoded = btoa(encodeURIComponent(JSON.stringify(questions)));
    params.set('qdata', encoded);

    const shareUrl = window.location.origin + window.location.pathname + '?' + params.toString();
    document.getElementById('share-link').value = shareUrl;
    show('screen-share');
  }
}

function copyLink() {
  const input = document.getElementById('share-link');
  input.select();
  input.setSelectionRange(0, 99999); // Mobile
  document.execCommand('copy');
  
  const feedback = document.getElementById('copy-feedback');
  feedback.style.opacity = '1';
  setTimeout(() => feedback.style.opacity = '0', 2000);
}

function shareNative() {
  const link = document.getElementById('share-link').value;
  if (navigator.share) {
    navigator.share({
      title: 'Find out if we\'re alike!',
      text: 'Answer these questions and see how much we have in common:',
      url: link
    }).catch(() => copyLink());
  } else {
    copyLink();
  }
}

function checkMatch() {
  const params = new URLSearchParams(window.location.search);
  const answersB = params.get('b');
  
  if (answersB) {
    window.location.reload();
  } else {
    alert('Your friend hasn\'t answered yet. Share the link with them!');
  }
}

// ========== RESULTS ==========

function showResultsForBoth(match) {
  const answersA = match.personA;
  const answersB = match.personB;
  
  // Compute match
  let matches = 0, total = 0;
  const resultItems = [];
  
  match.questions.forEach((q, i) => {
    const me = answersA[i];
    const friend = answersB[i];
    const [lEmoji, lText] = parseOption(q.l);
    const [rEmoji, rText] = parseOption(q.r);

    let status;
    if (me === 'skip' && friend === 'skip') {
      status = 'skip';
    } else if (me === 'skip' || friend === 'skip') {
      status = 'skip';
    } else {
      total++;
      if (me === friend) { matches++; status = 'match'; }
      else status = 'nomatch';
    }

    const meText = me === 'left' ? lEmoji+' '+lText : me === 'right' ? rEmoji+' '+rText : '‚Äì';
    const friendText = friend === 'left' ? lEmoji+' '+lText : friend === 'right' ? rEmoji+' '+rText : '‚Äì';

    resultItems.push({ meText, friendText, status });
  });

  const pct = total > 0 ? Math.round(matches/total*100) : 0;

  // Update UI
  document.getElementById('match-pct').textContent = pct + '%';

  let verdict, desc;
  if (pct >= 80) { verdict = 'üéâ Amazing Match!'; desc = 'You two are basically the same person. So much to talk about!'; }
  else if (pct >= 60) { verdict = '‚ú® Great Match!'; desc = 'You have a lot in common ‚Äì but also enough differences to keep things interesting.'; }
  else if (pct >= 40) { verdict = 'ü§ù Solid Match'; desc = 'Some shared ground, some differences. A perfect recipe for good conversation!'; }
  else { verdict = 'üå∂Ô∏è Opposites!'; desc = 'You see the world very differently. But opposites attract, right?'; }

  document.getElementById('match-verdict').textContent = verdict;
  document.getElementById('match-desc').textContent = desc;

  // Animate ring
  const circumference = 2 * Math.PI * 70;
  const offset = circumference - (pct/100) * circumference;
  const ring = document.getElementById('ring-fg');
  ring.style.strokeDasharray = circumference;
  ring.style.strokeDashoffset = circumference;
  if (pct >= 60) ring.style.stroke = 'var(--match)';
  else if (pct >= 40) ring.style.stroke = 'var(--accent2)';
  else ring.style.stroke = 'var(--accent)';

  // Results list
  const list = document.getElementById('results-list');
  list.innerHTML = resultItems.map(item => `
    <div class="result-item">
      <div class="result-a${item.status === 'match' ? ' winner' : ''}">${item.meText}</div>
      <div class="result-dot dot-${item.status}"></div>
      <div class="result-b${item.status === 'match' ? ' winner' : ''}">${item.friendText}</div>
    </div>
  `).join('');

  show('screen-match');

  // Animate ring after screen shows
  setTimeout(() => {
    ring.style.strokeDashoffset = offset;
  }, 200);

  // Animate score counter
  let count = 0;
  const pctEl = document.getElementById('match-pct');
  const interval = setInterval(() => {
    count = Math.min(count + Math.ceil(pct/30), pct);
    pctEl.textContent = count + '%';
    if (count >= pct) clearInterval(interval);
  }, 40);

  // Confetti if high match
  if (pct >= 70) launchConfetti();
}

function restartQuiz() {
  goHome();
}

// ========== DRAG & DROP ==========

function resetHints() {
  ['hint-left','hint-right','hint-up'].forEach(id => {
    document.getElementById(id).style.opacity = '0';
  });
  document.getElementById('opt-left').className = 'opt';
  document.getElementById('opt-right').className = 'opt';
}

function setupDrag() {
  card = document.getElementById('question-card');
  card.onmousedown = dragStart;
  card.ontouchstart = (e) => dragStart(e.touches[0]);
}

function dragStart(e) {
  isDragging = true;
  startX = e.clientX;
  startY = e.clientY;
  card.style.transition = 'none';

  document.onmousemove = dragMove;
  document.onmouseup = dragEnd;
  document.ontouchmove = (e) => dragMove(e.touches[0]);
  document.ontouchend = dragEnd;
}

function dragMove(e) {
  if (!isDragging) return;
  currentX = e.clientX - startX;
  currentY = e.clientY - startY;
  const rot = currentX * 0.08;
  card.style.transform = `translate(${currentX}px, ${currentY}px) rotate(${rot}deg)`;

  const absX = Math.abs(currentX);
  const absY = Math.abs(currentY);

  // Show hints
  if (currentX < -40) {
    document.getElementById('hint-left').style.opacity = Math.min(1, absX/100);
    document.getElementById('hint-right').style.opacity = '0';
    document.getElementById('hint-up').style.opacity = '0';
    document.getElementById('opt-left').className = 'opt highlight-left';
    document.getElementById('opt-right').className = 'opt';
  } else if (currentX > 40) {
    document.getElementById('hint-right').style.opacity = Math.min(1, absX/100);
    document.getElementById('hint-left').style.opacity = '0';
    document.getElementById('hint-up').style.opacity = '0';
    document.getElementById('opt-right').className = 'opt highlight-right';
    document.getElementById('opt-left').className = 'opt';
  } else if (currentY < -40) {
    document.getElementById('hint-up').style.opacity = Math.min(1, absY/80);
    document.getElementById('hint-left').style.opacity = '0';
    document.getElementById('hint-right').style.opacity = '0';
    document.getElementById('opt-left').className = 'opt';
    document.getElementById('opt-right').className = 'opt';
  } else {
    resetHints();
  }
}

function dragEnd() {
  if (!isDragging) return;
  isDragging = false;
  document.onmousemove = null; document.onmouseup = null;
  document.ontouchmove = null; document.ontouchend = null;

  const THRESHOLD_X = 100;
  const THRESHOLD_Y = 80;

  if (currentX < -THRESHOLD_X) answer('left');
  else if (currentX > THRESHOLD_X) answer('right');
  else if (currentY < -THRESHOLD_Y) answer('skip');
  else {
    // snap back
    card.style.transition = 'transform 0.4s cubic-bezier(0.34,1.56,0.64,1)';
    card.style.transform = '';
    resetHints();
  }
  currentX = 0; currentY = 0;
}

// ========== DRAG & DROP ==========

function launchConfetti() {
  const container = document.getElementById('confetti-container');
  const colors = ['#FFD166','#FF6B35','#2ECC7A','#1A1410','#F5F0E8'];
  for (let i = 0; i < 40; i++) {
    setTimeout(() => {
      const dot = document.createElement('div');
      dot.className = 'confetti-dot';
      dot.style.cssText = `
        left: ${Math.random()*100}%;
        top: -10px;
        background: ${colors[Math.floor(Math.random()*colors.length)]};
        width: ${4+Math.random()*8}px;
        height: ${4+Math.random()*8}px;
        animation-delay: 0s;
        animation-duration: ${0.8+Math.random()*1.2}s;
        border-radius: ${Math.random() > 0.5 ? '50%' : '2px'};
      `;
      container.appendChild(dot);
      setTimeout(() => dot.remove(), 2000);
    }, i * 30);
  }
}

function show(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

// Category selection
document.querySelectorAll('.cat-chip').forEach(chip => {
  chip.addEventListener('click', () => {
    document.querySelectorAll('.cat-chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
  });
});

// ========== CLICK TO ANSWER ==========

function answerClick(side) {
  const opt = document.getElementById('opt-' + side);
  opt.classList.add(side === 'left' ? 'chosen-left' : 'chosen-right');
  // Small delay so user sees the selection before card flies out
  setTimeout(() => answer(side), 180);
}

// ========== LIKE QUESTION ==========

function likeQuestion() {
  const btn = document.getElementById('like-btn');
  btn.classList.add('liked');
  btn.textContent = 'üëç';
  // Store like in localStorage
  const q = questions[currentIdx];
  if (q) {
    const cat = q._cat || currentCat;
    const idx = q._catIdx !== undefined ? q._catIdx : (QUESTIONS[cat] ? QUESTIONS[cat].indexOf(q) : -1);
    if (idx >= 0) {
      const key = `likes_${cat}_${idx}`;
      localStorage.setItem(key, (parseInt(localStorage.getItem(key) || '0') + 1).toString());
    }
  }
  // Reset after short time
  setTimeout(() => { btn.classList.remove('liked'); }, 1200);
}

// ========== NEW QUESTION MODAL ==========

function openNewQuestionModal() {
  // Set select to current category
  const sel = document.getElementById('new-q-cat');
  if (currentCat !== 'Random' && currentCat !== 'Popular') sel.value = currentCat;
  document.getElementById('new-q-left').value = '';
  document.getElementById('new-q-right').value = '';
  document.getElementById('modal-new-q').classList.add('open');
}

function closeNewQuestionModal(e) {
  if (!e || e.target === document.getElementById('modal-new-q')) {
    document.getElementById('modal-new-q').classList.remove('open');
  }
}

function submitNewQuestion() {
  const cat = document.getElementById('new-q-cat').value;
  const left = document.getElementById('new-q-left').value.trim();
  const right = document.getElementById('new-q-right').value.trim();
  if (!left || !right) { 
    document.getElementById('new-q-left').style.borderColor = left ? '' : 'var(--nomatch)';
    document.getElementById('new-q-right').style.borderColor = right ? '' : 'var(--nomatch)';
    return; 
  }
  const newQ = { l: left, r: right };
  QUESTIONS[cat].push(newQ);
  // Save to localStorage
  try {
    const saved = JSON.parse(localStorage.getItem('custom_questions') || '{}');
    if (!saved[cat]) saved[cat] = [];
    saved[cat].push(newQ);
    localStorage.setItem('custom_questions', JSON.stringify(saved));
  } catch(e) {}
  closeNewQuestionModal();
  // Show toast
  showToast('Question added to ' + cat + '! üéâ');
}

function showToast(msg) {
  const t = document.createElement('div');
  t.textContent = msg;
  t.style.cssText = `position:fixed;bottom:100px;left:50%;transform:translateX(-50%);background:var(--ink);color:var(--bg);padding:10px 20px;border-radius:100px;font-family:'Syne',sans-serif;font-size:13px;font-weight:700;z-index:400;opacity:0;transition:opacity 0.3s;white-space:nowrap;`;
  document.body.appendChild(t);
  requestAnimationFrame(() => { t.style.opacity = '1'; });
  setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 300); }, 2200);
}

// Load custom questions on startup
(function loadCustomQuestions() {
  try {
    const saved = JSON.parse(localStorage.getItem('custom_questions') || '{}');
    Object.keys(saved).forEach(cat => {
      if (QUESTIONS[cat]) QUESTIONS[cat].push(...saved[cat]);
    });
  } catch(e) {}
})();

// ========== BURGER MENU & DRAWER ==========

let drawerOpen = false;

function toggleDrawer() {
  drawerOpen ? closeDrawer() : openDrawer();
}

function openDrawer() {
  drawerOpen = true;
  document.getElementById('burger-btn').classList.add('open');
  document.getElementById('drawer-overlay').classList.add('open');
  document.getElementById('drawer').classList.add('open');
  // Update matches badge
  const matches = JSON.parse(localStorage.getItem('match_history') || '[]');
  document.getElementById('matches-badge').textContent = matches.length;
}

function closeDrawer() {
  drawerOpen = false;
  document.getElementById('burger-btn').classList.remove('open');
  document.getElementById('drawer-overlay').classList.remove('open');
  document.getElementById('drawer').classList.remove('open');
}

function navTo(page) {
  closeDrawer();
  if (page === 'home') {
    goHome(); return;
  }
  // Update active drawer item
  document.querySelectorAll('.drawer-item').forEach(i => i.classList.remove('active'));
  
  setTimeout(() => {
    if (page === 'matches') openPanel('panel-matches', renderMatches);
    if (page === 'messages') openPanel('panel-messages', renderMessages);
    if (page === 'settings') openPanel('panel-settings');
  }, 200);
}

function openPanel(id, renderFn) {
  document.getElementById(id).classList.add('open');
  if (renderFn) renderFn();
}

function closePanel(id) {
  document.getElementById(id).classList.remove('open');
}

// ========== MATCHES PANEL ==========

// Save match to history after quiz completes
function saveMatchToHistory(cat, pct, friendLabel) {
  try {
    const history = JSON.parse(localStorage.getItem('match_history') || '[]');
    history.unshift({ cat, pct, friend: friendLabel || 'Friend', date: new Date().toLocaleDateString() });
    localStorage.setItem('match_history', JSON.stringify(history.slice(0, 50)));
  } catch(e) {}
}

function renderMatches() {
  const body = document.getElementById('matches-body');
  const history = JSON.parse(localStorage.getItem('match_history') || '[]');
  if (history.length === 0) {
    body.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üéØ</div><div class="empty-state-title">No matches yet</div><div class="empty-state-sub">Complete a quiz and share your link to see your first match here!</div></div>`;
    return;
  }
  body.innerHTML = history.map((m, i) => `
    <div class="match-list-item" onclick="openChatFromMatch(${i})">
      <div class="match-cat-icon">${CATEGORY_EMOJI[m.cat] || 'üéØ'}</div>
      <div class="match-info">
        <div class="match-info-title">${m.cat}</div>
        <div class="match-info-sub">with ${m.friend} ¬∑ ${m.date}</div>
      </div>
      <div class="match-pct-badge">${m.pct}%</div>
    </div>
  `).join('');
}

// ========== MESSAGES PANEL ==========

function renderMessages() {
  const body = document.getElementById('messages-body');
  const convos = JSON.parse(localStorage.getItem('conversations') || '[]');
  if (convos.length === 0) {
    body.innerHTML = `<div class="empty-state"><div class="empty-state-icon">üíå</div><div class="empty-state-title">No messages yet</div><div class="empty-state-sub">After matching with a friend, start a chat from your Matches!</div></div>`;
    return;
  }
  body.innerHTML = convos.map((c, i) => `
    <div class="msg-list-item" onclick="openChat(${i})">
      <div class="msg-avatar">${c.avatar || 'üòä'}</div>
      <div class="msg-info">
        <div class="msg-name">${c.name}</div>
        <div class="msg-preview">${c.messages[c.messages.length-1]?.text || 'Say hi!'}</div>
      </div>
      <div class="msg-time">${c.messages[c.messages.length-1]?.time || ''}</div>
    </div>
  `).join('');
}

let currentConvoIdx = null;

function openChatFromMatch(matchIdx) {
  closePanel('panel-matches');
  const history = JSON.parse(localStorage.getItem('match_history') || '[]');
  const match = history[matchIdx];
  if (!match) return;
  
  // Find or create conversation
  const convos = JSON.parse(localStorage.getItem('conversations') || '[]');
  let idx = convos.findIndex(c => c.matchRef === matchIdx);
  if (idx < 0) {
    convos.push({ name: match.friend, avatar: 'üòä', matchRef: matchIdx, matchPct: match.pct, matchCat: match.cat, messages: [] });
    idx = convos.length - 1;
    localStorage.setItem('conversations', JSON.stringify(convos));
  }
  setTimeout(() => openChat(idx), 300);
}

function openChat(idx) {
  const convos = JSON.parse(localStorage.getItem('conversations') || '[]');
  const c = convos[idx];
  if (!c) return;
  currentConvoIdx = idx;
  
  document.getElementById('chat-name').textContent = c.name;
  document.getElementById('chat-avatar').textContent = c.avatar || 'üòä';
  document.getElementById('chat-match-info').textContent = (c.matchPct || '?') + '% match ¬∑ ' + (c.matchCat || '');
  
  const msgs = document.getElementById('chat-messages');
  msgs.innerHTML = c.messages.length ? c.messages.map(m => `
    <div class="chat-bubble ${m.from === 'me' ? 'me' : 'them'}">${m.text}</div>
  `).join('') : '<div style="text-align:center;color:var(--muted);font-size:13px;padding:20px;">Say hi! üëã</div>';
  msgs.scrollTop = msgs.scrollHeight;
  
  openPanel('panel-chat');
}

function sendMessage() {
  const input = document.getElementById('chat-input');
  const text = input.value.trim();
  if (!text || currentConvoIdx === null) return;
  
  const convos = JSON.parse(localStorage.getItem('conversations') || '[]');
  const now = new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  convos[currentConvoIdx].messages.push({ from: 'me', text, time: now });
  localStorage.setItem('conversations', JSON.stringify(convos));
  input.value = '';
  
  const msgs = document.getElementById('chat-messages');
  const bubble = document.createElement('div');
  bubble.className = 'chat-bubble me';
  bubble.textContent = text;
  msgs.appendChild(bubble);
  msgs.scrollTop = msgs.scrollHeight;
}

// Hook into showResultsForBoth to save match history
const _origShowResults = showResultsForBoth;
window.showResultsForBoth = function(match) {
  _origShowResults(match);
  // Save after a tick so pct is computed
  setTimeout(() => {
    const pctEl = document.getElementById('match-pct');
    const pct = parseInt(pctEl.textContent) || 0;
    saveMatchToHistory(match.category, pct, 'Friend');
    document.getElementById('matches-badge').textContent = 
      JSON.parse(localStorage.getItem('match_history') || '[]').length;
  }, 100);
};
</script>
<!-- ‚îÄ‚îÄ BURGER BUTTON ‚îÄ‚îÄ -->
<button class="burger-btn" id="burger-btn" onclick="toggleDrawer()">
  <span></span><span></span><span></span>
</button>

<!-- ‚îÄ‚îÄ DRAWER OVERLAY ‚îÄ‚îÄ -->
<div class="drawer-overlay" id="drawer-overlay" onclick="closeDrawer()"></div>

<!-- ‚îÄ‚îÄ DRAWER PANEL ‚îÄ‚îÄ -->
<div class="drawer" id="drawer">
  <div class="drawer-header">
    <div class="drawer-logo">
      <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="14" cy="14" r="7" fill="#FFD166"/>
        <circle cx="26" cy="26" r="7" fill="#FF6B35"/>
        <path d="M14 21 C14 21 18 26 26 19" stroke="#FFFDF8" stroke-width="2.5" stroke-linecap="round"/>
      </svg>
    </div>
    <div class="drawer-title">Alike</div>
  </div>

  <nav class="drawer-nav">
    <div class="drawer-section-title">Menu</div>

    <div class="drawer-item active" onclick="navTo('home')">
      <div class="drawer-icon">üè†</div>
      <div class="drawer-item-text">
        <div class="drawer-item-label">Home</div>
        <div class="drawer-item-sub">Pick a category & play</div>
      </div>
    </div>

    <div class="drawer-item" onclick="navTo('matches')">
      <div class="drawer-icon">üî•</div>
      <div class="drawer-item-text">
        <div class="drawer-item-label">Matches</div>
        <div class="drawer-item-sub">Your match history</div>
      </div>
      <div class="drawer-badge" id="matches-badge">0</div>
    </div>

    <div class="drawer-item" onclick="navTo('messages')">
      <div class="drawer-icon">üí¨</div>
      <div class="drawer-item-text">
        <div class="drawer-item-label">Messages</div>
        <div class="drawer-item-sub">Chat with your matches</div>
      </div>
      <div class="drawer-badge" id="msg-badge" style="display:none;">2</div>
    </div>

    <div class="drawer-section-title" style="margin-top:8px;">More</div>

    <div class="drawer-item" onclick="navTo('settings')">
      <div class="drawer-icon">‚öôÔ∏è</div>
      <div class="drawer-item-text">
        <div class="drawer-item-label">Settings</div>
        <div class="drawer-item-sub">Notifications, account‚Ä¶</div>
      </div>
    </div>
  </nav>

  <div class="drawer-footer">Alike ¬∑ Built with ‚ù§Ô∏è</div>
</div>

<!-- ‚îÄ‚îÄ MATCHES PANEL ‚îÄ‚îÄ -->
<div class="panel-screen" id="panel-matches">
  <div class="panel-header">
    <button class="panel-back" onclick="closePanel('panel-matches')">‚Üê</button>
    <div class="panel-title">üî• Matches</div>
  </div>
  <div class="panel-body" id="matches-body">
    <div class="empty-state">
      <div class="empty-state-icon">üéØ</div>
      <div class="empty-state-title">No matches yet</div>
      <div class="empty-state-sub">Complete a quiz and share your link with a friend to see your first match here!</div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ MESSAGES PANEL ‚îÄ‚îÄ -->
<div class="panel-screen" id="panel-messages">
  <div class="panel-header">
    <button class="panel-back" onclick="closePanel('panel-messages')">‚Üê</button>
    <div class="panel-title">üí¨ Messages</div>
  </div>
  <div class="panel-body" id="messages-body">
    <div class="empty-state">
      <div class="empty-state-icon">üíå</div>
      <div class="empty-state-title">No messages yet</div>
      <div class="empty-state-sub">After matching with a friend, you can start a conversation here!</div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ CHAT PANEL ‚îÄ‚îÄ -->
<div class="panel-screen" id="panel-chat" style="display:flex; flex-direction:column;">
  <div class="chat-header">
    <button class="panel-back" onclick="closePanel('panel-chat')">‚Üê</button>
    <div class="msg-avatar" id="chat-avatar">üòä</div>
    <div style="flex:1;">
      <div class="panel-title" id="chat-name" style="font-size:17px;">Friend</div>
      <div style="font-size:11px; color:var(--muted);" id="chat-match-info">‚Äî % match</div>
    </div>
  </div>
  <div class="chat-messages" id="chat-messages"></div>
  <div class="chat-input-bar">
    <input class="chat-input" id="chat-input" placeholder="Say something..." onkeydown="if(event.key==='Enter') sendMessage()">
    <button class="chat-send" onclick="sendMessage()">‚Üí</button>
  </div>
</div>

<!-- ‚îÄ‚îÄ SETTINGS PANEL ‚îÄ‚îÄ -->
<div class="panel-screen" id="panel-settings">
  <div class="panel-header">
    <button class="panel-back" onclick="closePanel('panel-settings')">‚Üê</button>
    <div class="panel-title">‚öôÔ∏è Settings</div>
  </div>
  <div class="panel-body">
    <div class="settings-section">
      <div class="settings-item">
        <div class="settings-item-icon">üîî</div>
        <div class="settings-item-label">Notifications</div>
        <button class="settings-toggle on" onclick="this.classList.toggle('on')"></button>
      </div>
      <div class="settings-item">
        <div class="settings-item-icon">üåô</div>
        <div class="settings-item-label">Dark Mode</div>
        <button class="settings-toggle" onclick="this.classList.toggle('on')"></button>
      </div>
      <div class="settings-item">
        <div class="settings-item-icon">üîä</div>
        <div class="settings-item-label">Sound Effects</div>
        <button class="settings-toggle on" onclick="this.classList.toggle('on')"></button>
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-item">
        <div class="settings-item-icon">üë§</div>
        <div class="settings-item-label">Display Name</div>
        <div class="settings-item-value">You</div>
      </div>
      <div class="settings-item">
        <div class="settings-item-icon">üóëÔ∏è</div>
        <div class="settings-item-label">Clear Match History</div>
        <div class="settings-item-value" style="color:var(--nomatch);">Clear</div>
      </div>
    </div>
    <div class="settings-section">
      <div class="settings-item">
        <div class="settings-item-icon">‚≠ê</div>
        <div class="settings-item-label">Rate Alike</div>
        <div class="settings-item-value">‚Üí</div>
      </div>
      <div class="settings-item">
        <div class="settings-item-icon">üì®</div>
        <div class="settings-item-label">Send Feedback</div>
        <div class="settings-item-value">‚Üí</div>
      </div>
    </div>
  </div>
</div>

<!-- ‚îÄ‚îÄ NEW QUESTION MODAL ‚îÄ‚îÄ -->
<div class="modal-overlay" id="modal-new-q" onclick="closeNewQuestionModal(event)">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-title">‚ûï Suggest a question</div>
    <select class="modal-cat-select" id="new-q-cat">
      <option value="Lifestyle">‚ú® Lifestyle</option>
      <option value="Food">üçï Food</option>
      <option value="Love">üíò Love</option>
      <option value="Music">üéµ Music</option>
      <option value="Travel">‚úàÔ∏è Travel</option>
      <option value="Culture">üé≠ Culture</option>
      <option value="Sports">‚öΩ Sports</option>
      <option value="Values">üß≠ Values</option>
      <option value="People">ü§ù People</option>
      <option value="Future">üöÄ Future</option>
    </select>
    <div class="modal-inputs-row">
      <input class="modal-input" id="new-q-left" placeholder="üÖ∞Ô∏è Option A" maxlength="30">
      <input class="modal-input" id="new-q-right" placeholder="üÖ±Ô∏è Option B" maxlength="30">
    </div>
    <button class="btn-primary" style="width:100%;" onclick="submitNewQuestion()">Add Question ‚úì</button>
  </div>
</div>

</body>
</html>
